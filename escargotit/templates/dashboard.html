{% extends "base/base.html" %}

{% block title %}
    Dashboard
{% endblock %}


{% block content %}

<div class="container">
    <div class="row">
        <div class="col">
            <!-- Left side content -->
            <h1>Welcome, {{ user.username }}!</h1>
            <p>User Profile Information:</p>
            <ul>
                <li>Full Name: {{ user.first_name }} {{ user.last_name }}</li>
                <li>Email: {{ user.email }}</li>
                <!-- Add more profile information here -->
            </ul>

            <h2>Settings</h2>
            <ul>
                <li><a href="{% url 'user_settings' %}">User Settings</a></li>
            </ul>

            <h2>Access Forms</h2>
            <ul>
                <li><a href="{% url 'snail_data_form' %}">Snail Feed Form</a></li>
                <!-- Add links for other forms -->
            </ul>
        </div>
        <div class="col">
            <!-- Right side content -->

            <h2>Snail Bed Boxes</h2>

            {% if error_message %}
                <h3>{{ error_message }}</h3>
            {% else %}
                <h3>Number of Snail Beds: {{ snail_bed_count }}</h3>

                <div class="rectangle">
                    <!-- Existing SnailBed boxes -->
                    {% for snail_bed in snail_beds %}
                        <div class="snail-box {% if snail_bed.is_empty %}empty{% else %}solid{% endif %}"
                                data-bed-name="{{ snail_bed.bed_name }}"
                                data-bed-employee="{{ snail_bed.employee }}"
                                data-bed-id="{{ snail_bed.id }}"
                                data-bed-hatch="{{ snail_bed.hatch_rate }}"
                                data-bed-mortality="{{ snail_bed.mortality_rate }}"
                                data-bed-snails="{{ snail_bed.snail_amount }}">
                            <span>{{ snail_bed.name }}</span>
                        </div>
                    {% endfor %}
                </div>

                {% if snail_bed_count > 0 %}
                    <button type="button" class="btn btn-primary" 
                            data-bs-toggle="modal" 
                            data-bs-target="#logDataModal"
                            data-snail-bed-id="{{ snail_bed.id }}">
                        Log Data
                    </button>
                {% endif %}

                
                <!-- Conditional check to display the "Create Box" button for admins only -->
                {% if current_user.can_create_snailbed %}
                    <form method="POST" action="{% url 'dashboard' %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-primary" name="add-box-button">Add Box</button>
                    </form>

                    {% if snail_bed_count > 0 %}
                        <!-- Button to delete all SnailBed objects for this user -->
                        <form method="POST" action="{% url 'delete_all_snailbeds' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger" name="delete-all-boxes-button">Delete All Boxes</button>
                        </form>
                    {% endif %}
                {% endif %}
                
            {% endif %}
        </div>
    </div>
    <!-- Container to display selected box data -->
    <div id="selected-box-data" class="container" style="display: none;">
        <h3>Selected Box Data</h3>
        <div id="box-name"></div>
        <div id="box-employee"></div>
        <div id="box-id"></div>
        <div id="box-hatch"></div>
        <div id="box-mortality"></div>
        <div id="box-snails"></div>
    </div>
</div>




<div class="modal fade" id="logDataModal" tabindex="-1" aria-labelledby="logDataModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="logDataModalLabel">Log Data Options</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Select an option:</p>
                <ul>
                    <li><a id="box-hatch-link" href="log_hatch_rate/">Log Hatched Snails</a></li>
                    <li><a id="box-mortality-link" href="log_mortality_rate/">Log Snails Expired</a></li>
                    <li><a id="box-feed-link" href="log_snail_feed/">Log Feed Given</a></li>
                   
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>




<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Get the button element
        var logDataButton = document.getElementById("logDataButton");
    
        // Add a click event listener to the button
        logDataButton.addEventListener("click", function () {
            // Show the modal with the specified ID when the button is clicked
            var logDataModal = new bootstrap.Modal(document.getElementById("logDataModal"));
            logDataModal.show();
        });
    });
</script>




<script>
document.addEventListener("DOMContentLoaded", function () {
    const rectangle = document.querySelector(".rectangle");

    // Toggle box border and display selected data
    function toggleBox(box) {
        const selectedBox = rectangle.querySelector(".snail-box.expanded");
        if (selectedBox) {
            selectedBox.classList.remove("expanded");
        }
        if (box !== selectedBox) {
            box.classList.add("expanded");
            const boxName = box.getAttribute("data-bed-name");
            const boxEmployees = box.getAttribute("data-bed-employee");
            const boxId = box.getAttribute("data-bed-id");
            const boxHatch = box.getAttribute("data-bed-hatch");
            const boxMortality = box.getAttribute("data-bed-mortality");
            const boxSnails = box.getAttribute("data-bed-snails");

            document.getElementById("box-name").innerText = "Name: " + boxName;

            if ( boxEmployees != "None") { 
                document.getElementById("box-employee").innerText = "Assigned employee: " + boxEmployees;
            } else { document.getElementById("box-employee").innerText = "Assigned employee: Not assigned";}

            document.getElementById("box-id").innerText = "id: " + boxId;

            if (boxHatch != "None") { 
                document.getElementById("box-hatch").innerText = "Hatch rate: " + boxHatch; 
            } else { document.getElementById("box-hatch").innerText = "Hatch rate: No data available"; }

            if (boxMortality != "None") { 
                document.getElementById("box-mortality").innerText = "Mortality rate: " + boxMortality; 
            } else { document.getElementById("box-mortality").innerText = "Hatch rate: No data available";}
            
            
            document.getElementById("box-snails").innerText = "Snails: " + boxSnails;

            document.getElementById("box-hatch-link").href = "/log_hatch_rate/" + boxId;
            document.getElementById("box-mortality-link").href = "/log_mortality_rate/" + boxId;
            document.getElementById("box-feed-link").href = "/log_snail_feed/" + boxId;

            document.getElementById("selected-box-data").style.display = "block";
        } else {
            document.getElementById("selected-box-data").style.display = "none";
        }
    }

    // Add click event listeners to all snail-box elements
    const snailBoxes = rectangle.querySelectorAll(".snail-box");
    snailBoxes.forEach(function (box) {
        box.addEventListener("click", function () {
            toggleBox(box);
        });
    });
});
</script>


<style>
    .rectangle {
        width: 50%; /* Takes the right half of the screen */
        border: 2px solid #ccc;
        padding: 10px;
        display: flex;
        flex-wrap: wrap;
    }

    .snail-box {
        width: calc(25% - 20px); /* 25% of the rectangle width with some spacing */
        border: 2px dashed #ccc;
        margin: 10px;
        padding: 10px;
        box-sizing: border-box;
        transition: border 0.3s ease-in-out;
        cursor: pointer;
    }

    .snail-box.empty {
        background-color: #f0f0f0;
    }

    .snail-box.expanded {
        border: 2px solid #000;
    }
</style>
{% endblock %}